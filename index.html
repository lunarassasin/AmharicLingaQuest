<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amharic LinguaQuest v3 - Multi-Exercise</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .main-card { min-height: 550px; }
        .btn { transition: all 0.2s ease-in-out; }
        .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .correct { background-color: #22c55e !important; color: white !important; border-color: #16a34a; }
        .incorrect { background-color: #ef4444 !important; color: white !important; border-color: #dc2626; }
        .selected { background-color: #3b82f6 !important; color: white !important; border-color: #2563eb; }
        .matched { background-color: #a3e635 !important; color: #3f6212 !important; border-color: #65a30d; opacity: 0.7; }
        .hidden { display: none; }
        #mic-btn.listening { animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto">
        <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8 main-card flex flex-col relative">

            <!-- Main Menu -->
            <div id="main-menu">
                <h1 class="text-3xl md:text-4xl font-bold text-center text-gray-800 mb-2">Amharic LinguaQuest</h1>
                <p class="text-center text-gray-500 mb-8">Wähle eine Übung aus</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button onclick="startExercise('vocabulary')" class="btn bg-blue-500 text-white p-6 rounded-lg font-semibold text-lg">Vocabulary Quiz</button>
                    <button onclick="startExercise('matching')" class="btn bg-green-500 text-white p-6 rounded-lg font-semibold text-lg">Word Matching</button>
                    <button onclick="startExercise('fill-blank')" class="btn bg-indigo-500 text-white p-6 rounded-lg font-semibold text-lg">Fill in the Blank</button>
                    <button onclick="startExercise('listening')" class="btn bg-yellow-500 text-white p-6 rounded-lg font-semibold text-lg">Listening Practice</button>
                    <button onclick="startExercise('speaking')" class="btn bg-red-500 text-white p-6 rounded-lg font-semibold text-lg">Speaking Practice</button>
                </div>
                 <div id="streak-display" class="text-center mt-8 text-lg font-bold text-orange-500"></div>
            </div>

            <!-- Exercise Area -->
            <div id="exercise-area" class="hidden flex-grow flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <button id="back-to-menu" class="text-sm font-semibold text-blue-600 hover:text-blue-800">← Main Menu</button>
                    <div id="exercise-streak" class="text-lg font-bold text-orange-500"></div>
                </div>
                <h2 id="exercise-title" class="text-2xl font-bold text-center mb-4"></h2>
                
                <!-- Progress Bar -->
                <div class="w-full bg-gray-200 rounded-full h-2.5 mb-6">
                    <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                </div>

                <!-- Vocabulary Quiz UI -->
                <div id="vocabulary-ui" class="hidden text-center">
                    <p id="vocab-prompt" class="text-lg text-gray-600 mb-2"></p>
                    <h3 id="vocab-word" class="text-4xl md:text-5xl font-bold text-blue-600 mb-8"></h3>
                    <div id="vocab-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                </div>

                <!-- Word Matching UI -->
                <div id="matching-ui" class="hidden">
                     <p class="text-center text-lg text-gray-600 mb-4">Tippe auf ein deutsches Wort und dann auf die amharische Übersetzung.</p>
                    <div class="grid grid-cols-2 gap-4">
                        <div id="german-words" class="flex flex-col gap-3"></div>
                        <div id="amharic-words" class="flex flex-col gap-3"></div>
                    </div>
                </div>

                <!-- Fill in the Blank UI -->
                <div id="fill-blank-ui" class="hidden text-center">
                    <p class="text-lg text-gray-600 mb-4">Fülle die Lücke aus:</p>
                    <div id="fill-blank-sentence" class="text-2xl md:text-3xl font-semibold text-gray-800 mb-8 bg-gray-100 p-6 rounded-lg"></div>
                    <div id="fill-blank-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                </div>

                <!-- Listening UI -->
                <div id="listening-ui" class="hidden text-center">
                     <p class="text-lg text-gray-600 mb-6">Höre gut zu und wähle die richtige Übersetzung.</p>
                     <button id="play-audio-btn" class="btn bg-blue-500 text-white p-6 rounded-full mb-8 mx-auto flex items-center justify-center w-24 h-24">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" viewBox="0 0 16 16"><path d="M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-1.414 1.414A6.472 6.472 0 0 1 12.026 8a6.472 6.472 0 0 1-1.904 4.606l1.414 1.414zM10.121 12.596A6.48 6.48 0 0 0 12.026 8a6.48 6.48 0 0 0-1.905-4.596l-1.414 1.414A4.486 4.486 0 0 1 10.026 8a4.486 4.486 0 0 1-1.313 3.182l1.414 1.414zM8.707 11.182A4.486 4.486 0 0 0 10.026 8a4.486 4.486 0 0 0-1.319-3.182L7.293 6.23A2.488 2.488 0 0 1 8.026 8a2.488 2.488 0 0 1-.732 1.768l1.414 1.414zM6 2.5a.5.5 0 0 1 .5.5v10a.5.5 0 0 1-1 0v-10a.5.5 0 0 1 .5-.5zM4 4.5a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0v-6a.5.5 0 0 1 .5-.5zm-2 2a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2a.5.5 0 0 1 .5-.5z"/></svg>
                     </button>
                     <div id="listening-options" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                </div>
                
                <!-- Speaking UI -->
                <div id="speaking-ui" class="hidden text-center">
                    <p class="text-lg text-gray-600 mb-4">Klicke auf das Mikrofon und sprich das Wort aus:</p>
                    <h3 id="speaking-word" class="text-4xl md:text-5xl font-bold text-red-600 mb-8"></h3>
                    <button id="mic-btn" class="btn bg-red-500 text-white p-6 rounded-full mb-6 mx-auto flex items-center justify-center w-24 h-24">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" viewBox="0 0 16 16"><path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z"/><path d="M10 8a2 2 0 1 1-4 0V3a2 2 0 1 1 4 0v5zM8 0a3 3 0 0 0-3 3v5a3 3 0 0 0 6 0V3a3 3 0 0 0-3-3z"/></svg>
                    </button>
                    <p id="speech-feedback" class="text-lg font-semibold h-8"></p>
                </div>

                <div id="feedback-message" class="mt-auto text-center text-xl font-semibold h-8"></div>
            </div>
            
            <!-- Result Screen -->
            <div id="result-screen" class="hidden text-center flex-grow flex flex-col items-center justify-center">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">Übung beendet!</h2>
                <p class="text-xl text-gray-600 mb-2">Dein Ergebnis:</p>
                <p id="score" class="text-5xl font-bold text-blue-600 mb-6"></p>
                <button id="restart-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-colors">Nochmal</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const vocabulary = [
            { german: "Hallo", amharic: "ሰላም" }, { german: "Danke", amharic: "አመሰግናለሁ" },
            { german: "Bitte", amharic: "እባክዎን" }, { german: "Ja", amharic: "አዎ" },
            { german: "Nein", amharic: "አይ" }, { german: "Wasser", amharic: "ውሃ" },
            { german: "Essen", amharic: "ምግብ" }, { german: "Haus", amharic: "ቤት" },
            { german: "Liebe", amharic: "ፍቅር" }, { german: "Freund", amharic: "ጓደኛ" },
            { german: "Guten Morgen", amharic: "እንደምን አደሩ" }, { german: "Auf Wiedersehen", amharic: "ደህና ሁኑ" },
            { german: "Ich", amharic: "እኔ" }, { german: "Du", amharic: "አንተ" }, { german: "Name", amharic: "ስም" },
        ];
        const sentences = [
            { german: "Mein Name ist ____.", amharic: "ስሜ ____ ነው።", blank: "Name" },
            { german: "Ich trinke ____.", amharic: "እኔ ____ እጠጣለሁ።", blank: "Wasser" },
            { german: "Das ist mein ____.", amharic: "ይህ የኔ ____ ነው።", blank: "Haus" },
        ];

        // --- STATE MANAGEMENT ---
        let state = {
            exerciseMode: null, currentQuestionIndex: 0, score: 0, currentStreak: 0, highestStreak: 0,
            shuffledData: [], selectedGerman: null, selectedAmharic: null, matchedPairs: 0
        };

        // --- SPEECH RECOGNITION SETUP ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'am-ET';
            recognition.continuous = false;
            recognition.interimResults = false;
        }

        // --- DOM ELEMENTS ---
        const mainMenu = document.getElementById('main-menu');
        const exerciseArea = document.getElementById('exercise-area');
        const resultScreen = document.getElementById('result-screen');
        const backToMenuBtn = document.getElementById('back-to-menu');
        const exerciseTitle = document.getElementById('exercise-title');
        const progressBar = document.getElementById('progress-bar');
        const feedbackMessage = document.getElementById('feedback-message');
        const streakDisplay = document.getElementById('streak-display');
        const exerciseStreak = document.getElementById('exercise-streak');
        // Exercise-specific elements
        const ui = {
            'vocabulary': document.getElementById('vocabulary-ui'),
            'matching': document.getElementById('matching-ui'),
            'fill-blank': document.getElementById('fill-blank-ui'),
            'listening': document.getElementById('listening-ui'),
            'speaking': document.getElementById('speaking-ui'),
        };
        const micBtn = document.getElementById('mic-btn');
        const speechFeedback = document.getElementById('speech-feedback');

        // --- LOCAL STORAGE ---
        function saveProgress() {
            localStorage.setItem('amharicLinguaQuestProgress', JSON.stringify({ highestStreak: state.highestStreak }));
        }
        function loadProgress() {
            const progress = JSON.parse(localStorage.getItem('amharicLinguaQuestProgress'));
            if (progress) {
                state.highestStreak = progress.highestStreak || 0;
                streakDisplay.textContent = `Höchster Streak: 🔥 ${state.highestStreak}`;
            }
        }

        // --- UTILITY ---
        const shuffleArray = (array) => array.sort(() => Math.random() - 0.5);
        const speak = (text, lang) => {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = lang;
                utterance.rate = 0.9;
                window.speechSynthesis.speak(utterance);
            }
        };

        // --- CORE LOGIC ---
        function showMainMenu() {
            mainMenu.classList.remove('hidden');
            exerciseArea.classList.add('hidden');
            resultScreen.classList.add('hidden');
            loadProgress();
        }

        function startExercise(mode) {
            state.exerciseMode = mode;
            state.currentQuestionIndex = 0;
            state.score = 0;
            state.currentStreak = 0;
            
            mainMenu.classList.add('hidden');
            exerciseArea.classList.remove('hidden');
            resultScreen.classList.add('hidden');
            Object.values(ui).forEach(el => el.classList.add('hidden'));
            if (ui[mode]) {
                ui[mode].classList.remove('hidden');
            }

            feedbackMessage.textContent = '';
            exerciseStreak.textContent = `🔥 ${state.currentStreak}`;
            
            switch (mode) {
                case 'vocabulary':
                    exerciseTitle.textContent = 'Vocabulary Quiz';
                    state.shuffledData = shuffleArray([...vocabulary]);
                    displayVocabularyQuestion();
                    break;
                case 'matching':
                    exerciseTitle.textContent = 'Word Matching';
                    state.shuffledData = shuffleArray([...vocabulary]).slice(0, 5); // 5 pairs
                    state.matchedPairs = 0;
                    displayMatchingExercise();
                    break;
                case 'fill-blank':
                     exerciseTitle.textContent = 'Fill in the Blank';
                     state.shuffledData = shuffleArray([...sentences]);
                     displayFillBlankQuestion();
                     break;
                case 'listening':
                    exerciseTitle.textContent = 'Listening Practice';
                    state.shuffledData = shuffleArray([...vocabulary]);
                    displayListeningQuestion();
                    break;
                case 'speaking':
                    exerciseTitle.textContent = 'Speaking Practice';
                    if (!recognition) {
                        alert("Sorry, your browser doesn't support Speech Recognition. Try Chrome or Edge.");
                        showMainMenu();
                        return;
                    }
                    state.shuffledData = shuffleArray([...vocabulary]);
                    displaySpeakingExercise();
                    break;
            }
        }

        function nextQuestion() {
            state.currentQuestionIndex++;
            feedbackMessage.textContent = '';
            
            const totalQuestions = state.shuffledData.length;
            if (state.currentQuestionIndex >= totalQuestions) {
                showResults();
                return;
            }

            switch (state.exerciseMode) {
                case 'vocabulary': displayVocabularyQuestion(); break;
                case 'fill-blank': displayFillBlankQuestion(); break;
                case 'listening': displayListeningQuestion(); break;
                case 'speaking': displaySpeakingExercise(); break;
            }
        }
        
        function updateProgress(total) {
            progressBar.style.width = `${((state.currentQuestionIndex + 1) / total) * 100}%`;
        }

        function handleAnswer(isCorrect) {
             if (isCorrect) {
                state.score++;
                state.currentStreak++;
                if (state.currentStreak > state.highestStreak) {
                    state.highestStreak = state.currentStreak;
                    saveProgress();
                }
                feedbackMessage.textContent = 'Richtig!';
                feedbackMessage.style.color = '#22c55e';
            } else {
                state.currentStreak = 0;
                feedbackMessage.textContent = 'Falsch!';
                feedbackMessage.style.color = '#ef4444';
            }
            exerciseStreak.textContent = `🔥 ${state.currentStreak}`;
        }

        // --- EXERCISE-SPECIFIC DISPLAY FUNCTIONS ---

        function displayVocabularyQuestion() {
            const isAmharicToGerman = Math.random() > 0.5;
            const questionData = state.shuffledData[state.currentQuestionIndex];
            const questionWord = isAmharicToGerman ? questionData.amharic : questionData.german;
            const correctAnswer = isAmharicToGerman ? questionData.german : questionData.amharic;
            const optionSource = isAmharicToGerman ? 'german' : 'amharic';

            document.getElementById('vocab-prompt').textContent = `Was bedeutet das Wort auf ${isAmharicToGerman ? 'Deutsch' : 'Amharisch'}?`;
            document.getElementById('vocab-word').textContent = questionWord;
            
            let options = shuffleArray([correctAnswer, ...shuffleArray(vocabulary.filter(v => v[optionSource] !== correctAnswer).map(v => v[optionSource])).slice(0, 3)]);
            const optionsContainer = document.getElementById('vocab-options');
            optionsContainer.innerHTML = '';
            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.textContent = opt;
                btn.className = 'btn w-full bg-white border-2 border-gray-300 text-gray-700 font-semibold py-4 px-4 rounded-lg';
                btn.onclick = () => {
                    handleAnswer(opt === correctAnswer);
                    btn.classList.add(opt === correctAnswer ? 'correct' : 'incorrect');
                    optionsContainer.querySelectorAll('button').forEach(b => b.disabled = true);
                    if (opt !== correctAnswer) {
                        const correctBtn = Array.from(optionsContainer.querySelectorAll('button')).find(b => b.textContent === correctAnswer);
                        correctBtn.classList.add('correct');
                    }
                    setTimeout(nextQuestion, 1500);
                };
                optionsContainer.appendChild(btn);
            });
            updateProgress(state.shuffledData.length);
        }

        function displayMatchingExercise() {
            const germanContainer = document.getElementById('german-words');
            const amharicContainer = document.getElementById('amharic-words');
            germanContainer.innerHTML = '';
            amharicContainer.innerHTML = '';

            const germanWords = shuffleArray(state.shuffledData.map(v => v.german));
            const amharicWords = shuffleArray(state.shuffledData.map(v => v.amharic));

            germanWords.forEach(word => {
                const btn = document.createElement('button');
                btn.textContent = word;
                btn.className = 'btn w-full bg-white border-2 border-gray-300 text-gray-700 font-semibold py-3 px-4 rounded-lg';
                btn.onclick = () => {
                    if (state.selectedGerman) state.selectedGerman.classList.remove('selected');
                    state.selectedGerman = btn;
                    btn.classList.add('selected');
                    checkMatch();
                };
                germanContainer.appendChild(btn);
            });

             amharicWords.forEach(word => {
                const btn = document.createElement('button');
                btn.textContent = word;
                btn.className = 'btn w-full bg-white border-2 border-gray-300 text-gray-700 font-semibold py-3 px-4 rounded-lg';
                btn.onclick = () => {
                    if (state.selectedAmharic) state.selectedAmharic.classList.remove('selected');
                    state.selectedAmharic = btn;
                    btn.classList.add('selected');
                    checkMatch();
                };
                amharicContainer.appendChild(btn);
            });
        }
        
        function checkMatch() {
            if (!state.selectedGerman || !state.selectedAmharic) return;
            
            const germanText = state.selectedGerman.textContent;
            const amharicText = state.selectedAmharic.textContent;
            const correctPair = vocabulary.find(v => v.german === germanText && v.amharic === amharicText);

            if (correctPair) {
                state.matchedPairs++;
                state.selectedGerman.classList.add('matched');
                state.selectedAmharic.classList.add('matched');
                state.selectedGerman.disabled = true;
                state.selectedAmharic.disabled = true;
                handleAnswer(true);
            } else {
                state.selectedGerman.classList.add('incorrect');
                state.selectedAmharic.classList.add('incorrect');
                handleAnswer(false);
            }
            
            setTimeout(() => {
                if (state.selectedGerman) state.selectedGerman.classList.remove('selected', 'incorrect');
                if (state.selectedAmharic) state.selectedAmharic.classList.remove('selected', 'incorrect');
                state.selectedGerman = null;
                state.selectedAmharic = null;

                if (state.matchedPairs === state.shuffledData.length) {
                    feedbackMessage.textContent = 'Super gemacht!';
                    setTimeout(showResults, 1500);
                }
            }, 800);
        }

        function displayFillBlankQuestion() {
            const questionData = state.shuffledData[state.currentQuestionIndex];
            const sentenceContainer = document.getElementById('fill-blank-sentence');
            sentenceContainer.innerHTML = questionData.amharic.replace('____', `<span class="font-bold text-blue-600">____</span>`);
            
            const correctAnswer = vocabulary.find(v => v.german === questionData.blank)?.amharic;
            if (!correctAnswer) {
                console.error("Could not find Amharic word for blank:", questionData.blank);
                nextQuestion(); // Skip broken question
                return;
            }
            const options = shuffleArray([correctAnswer, ...shuffleArray(vocabulary.filter(v => v.amharic !== correctAnswer).map(v => v.amharic)).slice(0, 3)]);
            const optionsContainer = document.getElementById('fill-blank-options');
            optionsContainer.innerHTML = '';

            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.textContent = opt;
                btn.className = 'btn w-full bg-white border-2 border-gray-300 text-gray-700 font-semibold py-4 px-4 rounded-lg';
                btn.onclick = () => {
                    const isCorrect = opt === correctAnswer;
                    handleAnswer(isCorrect);
                    btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                    if (isCorrect) {
                        sentenceContainer.innerHTML = questionData.amharic.replace('____', `<span class="font-bold text-green-600">${correctAnswer}</span>`);
                    }
                    optionsContainer.querySelectorAll('button').forEach(b => b.disabled = true);
                    setTimeout(nextQuestion, 2000);
                };
                optionsContainer.appendChild(btn);
            });
            updateProgress(state.shuffledData.length);
        }
        
        function displayListeningQuestion() {
            const questionData = state.shuffledData[state.currentQuestionIndex];
            const correctAnswer = questionData.german;
            const options = shuffleArray([correctAnswer, ...shuffleArray(vocabulary.filter(v => v.german !== correctAnswer).map(v => v.german)).slice(0, 3)]);
            const optionsContainer = document.getElementById('listening-options');
            optionsContainer.innerHTML = '';

            document.getElementById('play-audio-btn').onclick = () => speak(questionData.amharic, 'am-ET');
            speak(questionData.amharic, 'am-ET'); // Play on load

            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.textContent = opt;
                btn.className = 'btn w-full bg-white border-2 border-gray-300 text-gray-700 font-semibold py-4 px-4 rounded-lg';
                btn.onclick = () => {
                    handleAnswer(opt === correctAnswer);
                    btn.classList.add(opt === correctAnswer ? 'correct' : 'incorrect');
                    optionsContainer.querySelectorAll('button').forEach(b => b.disabled = true);
                    setTimeout(nextQuestion, 1500);
                };
                optionsContainer.appendChild(btn);
            });
            updateProgress(state.shuffledData.length);
        }
        
        function displaySpeakingExercise() {
            speechFeedback.textContent = '';
            const questionData = state.shuffledData[state.currentQuestionIndex];
            document.getElementById('speaking-word').textContent = questionData.amharic;
            updateProgress(state.shuffledData.length);
        }

        // --- RESULTS ---
        function showResults() {
            exerciseArea.classList.add('hidden');
            resultScreen.classList.remove('hidden');
            const total = state.exerciseMode === 'matching' ? state.shuffledData.length : state.currentQuestionIndex;
            document.getElementById('score').textContent = `${state.score} / ${total}`;
            document.getElementById('restart-btn').onclick = () => startExercise(state.exerciseMode);
        }

        // --- EVENT LISTENERS ---
        backToMenuBtn.addEventListener('click', showMainMenu);
        
        micBtn.addEventListener('click', () => {
            micBtn.classList.add('listening');
            speechFeedback.textContent = 'Listening...';
            try {
                recognition.start();
            } catch (e) {
                console.error("Speech recognition error:", e);
                speechFeedback.textContent = 'Error starting mic.';
                micBtn.classList.remove('listening');
            }
        });

        if (recognition) {
            recognition.onresult = (event) => {
                const spokenText = event.results[0][0].transcript;
                const targetText = state.shuffledData[state.currentQuestionIndex].amharic;
                
                speechFeedback.textContent = `You said: "${spokenText}"`;
                const isCorrect = spokenText.trim() === targetText.trim();
                handleAnswer(isCorrect);
                
                if (isCorrect) {
                    speechFeedback.style.color = '#22c55e';
                } else {
                    speechFeedback.style.color = '#ef4444';
                    feedbackMessage.textContent = `Try again! The correct word is ${targetText}`;
                }

                if (isCorrect) {
                    setTimeout(nextQuestion, 2000);
                }
            };
            recognition.onend = () => {
                micBtn.classList.remove('listening');
            };
            recognition.onerror = (event) => {
                speechFeedback.textContent = `Error: ${event.error}`;
                micBtn.classList.remove('listening');
            };
        }

        // --- INITIALIZATION ---
        window.onload = showMainMenu;
    </script>
</body>
</html>
